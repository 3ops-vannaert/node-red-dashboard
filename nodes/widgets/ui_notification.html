<script type="text/javascript">
    (function () {
        function hasProperty (obj, prop) {
            return Object.prototype.hasOwnProperty.call(obj, prop)
        }
        RED.nodes.registerType('ui-notification', {
            category: RED._('@flowforge/node-red-dashboard/ui-base:ui-base.label.category'),
            color: 'rgb(119, 198, 204)',
            defaults: {
                ui: { type: 'ui-base', value: '', required: true },
                position: { value: 'top right' },
                displayTime: { value: '3' },
                highlight: { value: '' },
                sendall: { value: true },
                outputs: { value: 0 },
                ok: { value: 'OK', required: true },
                cancel: { value: '' },
                raw: { value: false },
                className: { value: '' },
                topic: { value: 'topic', validate: (hasProperty(RED.validators, 'typedInput') ? RED.validators.typedInput('topicType') : function (v) { return true }) },
                topicType: { value: 'msg' },
                name: { value: '' }
            },
            inputs: 1,
            outputs: 0,
            align: 'right',
            icon: 'font-awesome/fa-envelope-o',
            paletteLabel: 'notification',
            label: function () { return this.name || (this.position === 'prompt' ? 'show dialog' : (this.position === 'dialog' ? 'show dialog' : 'show notification')) },
            labelStyle: function () { return this.name ? 'node_label_italic' : '' },
            oneditprepare: function () {
                $('#node-input-topic').typedInput({
                    default: 'str',
                    typeField: $('#node-input-topicType'),
                    types: ['str', 'msg', 'flow', 'global']
                })
    
                $('#node-input-position').on('change', function () {
                    if ($('#node-input-position option:selected').val() === 'dialog') {
                        $('#node-toast-displaytime').hide()
                        $('#node-toast-highlightcolor').hide()
                        $('#node-toast-sendall').hide()
                        $('#node-dialog-displayok').show()
                        $('#node-dialog-displaycancel').show()
                        $('#node-dialog-topic').show()
                    } else if ($('#node-input-position option:selected').val() === 'prompt') {
                        $('#node-toast-displaytime').hide()
                        $('#node-toast-highlightcolor').hide()
                        $('#node-toast-sendall').hide()
                        $('#node-dialog-displayok').show()
                        $('#node-dialog-displaycancel').show()
                        $('#node-dialog-topic').show()
                        if (typeof $('#node-input-cancel').val() !== 'string' || $('#node-input-cancel').val() === '') {
                            $('#node-input-cancel').val('Cancel')
                        }
                    } else {
                        $('#node-toast-displaytime').show()
                        $('#node-toast-highlightcolor').show()
                        $('#node-toast-sendall').show()
                        $('#node-dialog-displayok').hide()
                        $('#node-dialog-displaycancel').hide()
                        $('#node-dialog-topic').show()
                    }
    
                    // use jQuery UI tooltip to convert the plain old title attribute to a nice tooltip
                    $('.ui-node-popover-title').tooltip({
                        show: {
                            effect: 'slideDown',
                            delay: 150
                        }
                    })
                })
            },
            oneditsave: function () {
                if ($('#node-input-position option:selected').val() === 'dialog') { this.outputs = 1 } else if ($('#node-input-position option:selected').val() === 'prompt') { this.outputs = 1 } else { this.outputs = 0 }
            }
        })
    })()
</script>

<script type="text/html" data-template-name="ui-notification">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-ui"><i class="fa fa-bookmark"></i> UI</label>
        <input type="text" id="node-input-ui">
    </div>
    <div class="form-row">
        <label for="node-input-position"><i class="fa fa-th-large"></i> Layout</label>
        <select type="text" id="node-input-position" style="display:inline-block; width:70%; vertical-align:baseline;">
            <option value="top right">Top Right</option>
            <option value="bottom right">Bottom Right</option>
            <option value="top left">Top Left</option>
            <option value="bottom left">Bottom Left</option>
            <option value="dialog">OK / Cancel Dialog</option>
            <option value="prompt">OK / Cancel Dialog with Input</option>
        </select>
    </div>
    <div class="form-row" id="node-toast-displaytime">
        <label for="node-input-displayTime"><i class="fa fa-clock-o"></i> Timeout (S)</label>
        <input type="text" id="node-input-displayTime" placeholder="[msg.timeout]">
    </div>
    <div class="form-row" id="node-toast-highlightcolor">
        <label for="node-input-highlight"><i class="fa fa-square-o"></i> Border</label>
        <input type="text" id="node-input-highlight" placeholder="(optional) border highlight colour">
    </div>
    <div class="form-row" id="node-toast-sendtoall">
        <label style="width:auto" for="node-input-sendall"><i class="fa fa-arrow-right"></i> Send to all browser sessions. </label>
        <input type="checkbox" checked id="node-input-sendall" style="display:inline-block; width:auto; vertical-align:baseline;">
    </div>
    <div class="form-row" id="node-dialog-displayok">
        <label for="node-input-ok"><i class="fa fa-check"></i> Default action label</label>
        <input type="text" id="node-input-ok" placeholder="label for OK button">
    </div>
    <div class="form-row" id="node-dialog-displaycancel">
        <label for="node-input-cancel"><i class="fa fa-times"></i> Secondary action label</label>
        <input type="text" id="node-input-cancel" placeholder="(optional label for Cancel button)">
    </div>
    <div class="form-row" id="node-toast-raw">
        <label style="width:auto" for="node-input-raw"><i class="fa fa-exclamation-triangle"></i> Accept raw HTML/JavaScript input in msg.payload to format popup.</label>
        <input type="checkbox" id="node-input-raw" style="display:inline-block; width:auto; vertical-align:baseline;">
    </div>
    <div class="form-row">
        <label for="node-input-className"><i class="fa fa-code"></i> Class</label>
        <div style="display: inline;">
            <input style="width: 70%;" type="text" id="node-input-className" placeholder="Optional CSS class name(s)" style="flex-grow: 1;">
            <a
                data-html="true"
                title="Dynamic Property: Class names can also be set by sending a message to the node with a msg.topic of 'ui-property:class' and a payload containing the class name(s) to be applied. NOTE: classes set at runtime will be applied in addition to any class(es) set in the nodes class field."
                class="red-ui-button ui-node-popover-title"
                style="margin-left: 4px; cursor: help; font-size: 0.625rem; border-radius: 50%; width: 24px; height: 24px; display: inline-flex; justify-content: center; align-items: center;">
                <i style="font-family: ui-serif;">fx</i>
            </a>
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" style="width:70%" placeholder="optional msg.topic">
        <input type="hidden" id="node-input-topicType">
    </div>
    <div class="form-tips"><b>Note</b>: checking <i>Accept raw HTML/JavaScript</i> can allow injection of code.
    Ensure the input comes from trusted sources.</span></div>
</script>